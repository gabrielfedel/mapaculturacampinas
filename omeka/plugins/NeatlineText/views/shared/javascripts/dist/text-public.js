Neatline.module("Text",function(a){a.Controller=Neatline.Shared.Controller.extend({slug:"TEXT",events:["highlight","unhighlight","select","unselect"],requests:["getSpansByModel"],init:function(){this.view=new Neatline.Text.View({slug:this.slug})},highlight:function(a){this.view.renderHighlight(a.model)},unhighlight:function(a){this.view.renderUnhighlight(a.model)},select:function(a){this.view.renderSelect(a.model),this.view.scrollTo(a.model),this.unhighlight(a)},unselect:function(a){this.view.renderUnselect(a.model),this.unhighlight(a)},getSpansByModel:function(a){return this.view.getSpansWithSlug(a.get("slug"))}})}),Neatline.module("Text",function(a){a.addInitializer(function(){a.__controller=new a.Controller})}),Neatline.module("Text",function(a){a.View=Backbone.View.extend({el:"#neatline-narrative",events:{"mouseenter [data-neatline-slug]":"publishHighlight","mouseleave [data-neatline-slug]":"publishUnhighlight","click [data-neatline-slug]":"publishSelect",click:"publishUnselect"},options:{duration:200,padding:200},initialize:function(a){this.slug=a.slug,this.model=null,this.records=new Neatline.Shared.Record.Collection(Neatline.g.text.records)},publishHighlight:function(a){var b=this.getModelFromEvent(a);b&&this.publish("highlight",b,a)},publishUnhighlight:function(a){var b=this.getModelFromEvent(a);b&&this.publish("unhighlight",b,a)},publishSelect:function(a){var b=this.getModelFromEvent(a);b&&this.publish("select",b,a),a.stopPropagation()},publishUnselect:function(a){this.model&&this.publish("unselect",this.model,a)},renderHighlight:function(a){this.getSpansWithSlug(a.get("slug")).addClass("highlighted")},renderUnhighlight:function(a){this.getSpansWithSlug(a.get("slug")).removeClass("highlighted")},renderSelect:function(a){this.publishUnselect(),this.getSpansWithSlug(a.get("slug")).addClass("selected"),this.model=a},renderUnselect:function(a){this.getSpansWithSlug(a.get("slug")).removeClass("selected"),this.model=null},scrollTo:function(a){var b=this.getSpansWithSlug(a.get("slug"))[0];b&&this.$el.animate({scrollTop:b.offsetTop-this.options.padding},{duration:this.options.duration})},getSpansWithSlug:function(a){return this.$('[data-neatline-slug="'+a+'"]')},getSlugFromEvent:function(a){return $(a.currentTarget).attr("data-neatline-slug")},getModelFromEvent:function(a){return this.records.findWhere({slug:this.getSlugFromEvent(a)})},publish:function(a,b,c){Neatline.vent.trigger(a,{model:b,event:c,source:this.slug})}})});